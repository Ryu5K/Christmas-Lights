<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Christmas Lights Grid</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: "Segoe UI", sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
  }
  canvas {
    border: 2px solid #444;
    image-rendering: pixelated;
    width: 800px;
    height: 800px;
    margin-bottom: 10px;
  }
  #count {
    font-size: 1.2em;
    color: #ff0;
    text-align: center;
  }
</style>
</head>
<body>
<h2>ðŸŽ„ Christmas Light Grid Visualization ðŸŽ„</h2>
<canvas id="lightCanvas" width="1000" height="1000"></canvas>
<p id="count">Loading...</p>

<script>
async function drawGrid() {
  try {
    const response = await fetch("grid.json?nocache=" + Date.now());
    const data = await response.json();
    const grid = data.grid;
    const countOn = data.count_on;
    const countOff = data.count_off;

    document.getElementById("count").innerHTML =
      `ðŸ’¡ Lights On: ${countOn.toLocaleString()}<br>` +
      `ðŸŒ‘ Lights Off: ${countOff.toLocaleString()}<br>` +
      `Total: ${(countOn + countOff).toLocaleString()}`;

    const canvas = document.getElementById("lightCanvas");
    const ctx = canvas.getContext("2d");
    const width = grid[0].length;
    const height = grid.length;

    const imgData = ctx.createImageData(width, height);
    const pixels = imgData.data;

    for (let y = 0; y < height; y++) {
      for (let x = 0; x < width; x++) {
        const i = (y * width + x) * 4;
        if (grid[y][x]) {
          pixels[i] = 255; pixels[i + 1] = 255; pixels[i + 2] = 0;   // Yellow (on)
        } else {
          pixels[i] = 30; pixels[i + 1] = 30; pixels[i + 2] = 30;    // Dim gray (off)
        }
        pixels[i + 3] = 255;
      }
    }
    ctx.putImageData(imgData, 0, 0);

  } catch (err) {
    document.body.innerHTML += `<p style="color:red;">Error loading grid.json: ${err}</p>`;
    console.error("Error loading grid.json:", err);
  }
}

drawGrid();
</script>
</body>
</html>
